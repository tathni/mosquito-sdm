# This script cleans the raw species occurrence datasets before the SDM

# Setup
library(dplyr)
setwd("E:/SynologyDrive/Tejas_Server/! Research/! Mordecai Lab/! Mosquito SDM MaxEnt Mechanistic/")


# Read in all mosquitoes of Culicidae for background points
Mosquitoes_All_Raw <- read.csv("GBIF Datasets Raw/AllMosquitoes_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F)


# Read in mosquito species of interest datasets (GBIF, Atlas of Living Australia, and Dryad)
Mosquitoes_SpeciesOfInterest_Raw <- rbind(
  read.csv("GBIF Datasets Raw/AedesAegypti_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F),
  read.csv("GBIF Datasets Raw/AedesAlbopictus_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F),
  read.csv("GBIF Datasets Raw/AnophelesGambiae_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F),
  read.csv("GBIF Datasets Raw/AnophelesStephensi_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F),
  read.csv("GBIF Datasets Raw/CulexAnnulirostris_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F),
  read.csv("GBIF Datasets Raw/CulexPipiens_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F),
  read.csv("GBIF Datasets Raw/CulexQuinquefasciatus_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F),
  read.csv("GBIF Datasets Raw/CulexTarsalis_Raw.csv", sep = "\t", header = T, encoding = "UTF-8", stringsAsFactors = F)
)

Mosquitoes_AtlasAustralia_Raw <- read.csv("GBIF Datasets Raw/CulexAnnulirostris_ALA.csv", sep = ",", header = T, encoding = "UTF-8", stringsAsFactors = F)

Mosquitoes_Dryad_Raw <- read.csv("GBIF Datasets Raw/AnophelesStephensi_Dryad.csv", sep = ",", header = T, stringsAsFactors = F)


# Clean occurrence data by relevant parameters and filter occurrences from 2000-2020
Mosquitoes_All <- Mosquitoes_All_Raw %>%
  filter(basisOfRecord != "FOSSIL_SPECIMEN" & species != "") %>%
  filter(is.na(coordinateUncertaintyInMeters) | coordinateUncertaintyInMeters <= 1000) %>%
  filter(year >= 2000 & year <= 2019) %>%
  select(species, decimalLongitude, decimalLatitude, countryCode, year, month, day, identifiedBy)

Mosquitoes_SpeciesOfInterest <- Mosquitoes_SpeciesOfInterest_Raw %>%
  filter(basisOfRecord != "FOSSIL_SPECIMEN" & species != "") %>%
  filter(is.na(coordinateUncertaintyInMeters) | coordinateUncertaintyInMeters <= 1000) %>%
  filter(year >= 2000 & year <= 2019) %>%
  select(species, decimalLongitude, decimalLatitude, countryCode, year, month, day, identifiedBy)


# Clean the Atlas of Living Australia dataset
Mosquitoes_AtlasAustralia <- Mosquitoes_AtlasAustralia_Raw %>%
  filter(Species != "") %>%
  filter(is.na(Coordinate.Uncertainty.in.Metres) | Coordinate.Uncertainty.in.Metres <= 1000) %>%
  filter(Year >= 2000 & Year <= 2019) %>%
  select(Species, Longitude, Latitude, Year, Month, Day, Collector) %>%
  mutate(countryCode = "AU")

names(Mosquitoes_AtlasAustralia)[names(Mosquitoes_AtlasAustralia) == "Species"] <- "species"
names(Mosquitoes_AtlasAustralia)[names(Mosquitoes_AtlasAustralia) == "Longitude"] <- "decimalLongitude"
names(Mosquitoes_AtlasAustralia)[names(Mosquitoes_AtlasAustralia) == "Latitude"] <- "decimalLatitude"
names(Mosquitoes_AtlasAustralia)[names(Mosquitoes_AtlasAustralia) == "Year"] <- "year"
names(Mosquitoes_AtlasAustralia)[names(Mosquitoes_AtlasAustralia) == "Month"] <- "month"
names(Mosquitoes_AtlasAustralia)[names(Mosquitoes_AtlasAustralia) == "Day"] <- "day"
names(Mosquitoes_AtlasAustralia)[names(Mosquitoes_AtlasAustralia) == "Collector"] <- "identifiedBy"

Mosquitoes_AtlasAustralia <- Mosquitoes_AtlasAustralia[, colnames(Mosquitoes_AtlasAustralia)[c(1:3,5,7,6,8,4)]]


# Merge the cleaned occurrences and Atlas of Living Australia data frames
Mosquitoes_SpeciesOfInterest_Combined <- rbind(Mosquitoes_SpeciesOfInterest, Mosquitoes_AtlasAustralia)


# Clean the Dryad dataset
Mosquitoes_Dryad <- Mosquitoes_Dryad_Raw %>%
  filter(year_start >= 2000 | (is.na(year_start) & publication_year >= 2010)) %>%
  filter (country != "Sudan" & country != "Djibouti" & country != "Ethiopia" & country != "Ehiopia") %>%
  select(latitude, longitude, year_start, country) %>%
  mutate(species = "Anopheles stephensi")

Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "Iran"] <- "IR"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "Pakistan"] <- "PK"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "India"] <- "IN"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "Thailand"] <- "TH"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "China"] <- "CN"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "Myanmar"] <- "MM"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "Saudi Arabia"] <- "SA"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "Qatar"] <- "QA"
Mosquitoes_Dryad$country[Mosquitoes_Dryad$country == "Sri Lanka"] <- "LK"

names(Mosquitoes_Dryad)[names(Mosquitoes_Dryad) == "latitude"] <- "decimalLatitude"
names(Mosquitoes_Dryad)[names(Mosquitoes_Dryad) == "longitude"] <- "decimalLongitude"
names(Mosquitoes_Dryad)[names(Mosquitoes_Dryad) == "year_start"] <- "year"
names(Mosquitoes_Dryad)[names(Mosquitoes_Dryad) == "country"] <- "countryCode"

Mosquitoes_Dryad <- Mosquitoes_Dryad[, colnames(Mosquitoes_Dryad)[c(5,2,1,4,3)]]


# Remove duplicate species occurrences
Mosquitoes_All <- rbind(Mosquitoes_All, Mosquitoes_AtlasAustralia)
Mosquitoes_All_Final <- Mosquitoes_All %>%
  subset(!duplicated(subset(Mosquitoes_SpeciesOfInterest, select=c(species, decimalLongitude, decimalLatitude,
                                                                   countryCode,year, month, day, identifiedBy)
                                                                   ))) %>%
  select(species, decimalLongitude, decimalLatitude, countryCode, year)

Mosquitoes_All_Final <- rbind(Mosquitoes_All_Final, Mosquitoes_Dryad)

Mosquitoes_SpeciesOfInterest_GBIF_ALA <- Mosquitoes_SpeciesOfInterest_Combined %>%
  subset(!duplicated(subset(Mosquitoes_SpeciesOfInterest, select=c(species, decimalLongitude, decimalLatitude,
                                                                   countryCode, year, month, day, identifiedBy)
                                                                   ))) %>%
  select(species, decimalLongitude, decimalLatitude, countryCode, year)

Mosquitoes_SpeciesOfInterest_Final <- rbind(Mosquitoes_SpeciesOfInterest_GBIF_ALA, Mosquitoes_Dryad)


# Write CSV files containing cleaned datasets for use in the SDM
write.csv(Mosquitoes_All_Final, file = "GBIF Datasets Cleaned/Mosquitoes_All_Cleaned.csv", row.names = F)

write.csv(Mosquitoes_SpeciesOfInterest_Final, file = "GBIF Datasets Cleaned/Mosquitoes_SpeciesOfInterest_Cleaned.csv", row.names = F)

